[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
user=root

[program:nginx]
command=/usr/sbin/nginx -g 'daemon off;'
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/nginx-stdout.log
stderr_logfile=/var/log/supervisor/nginx-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB

[program:gunicorn]
command=/opt/venv/bin/gunicorn config.wsgi:application --config /app/docker/gunicorn_config.py
directory=/app
autostart=true
autorestart=true
priority=20
environment=PYTHONUNBUFFERED=1,PATH="/opt/venv/bin:%(ENV_PATH)s"
stdout_logfile=/var/log/supervisor/gunicorn-stdout.log
stderr_logfile=/var/log/supervisor/gunicorn-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stopwaitsecs=30

[program:celery_worker]
command=/opt/venv/bin/celery -A config worker --loglevel=info --concurrency=4
directory=/app
autostart=true
autorestart=true
priority=30
environment=PYTHONUNBUFFERED=1,PATH="/opt/venv/bin:%(ENV_PATH)s"
stdout_logfile=/var/log/supervisor/celery_worker-stdout.log
stderr_logfile=/var/log/supervisor/celery_worker-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stopwaitsecs=60
killasgroup=true
stopasgroup=true

[program:celery_beat]
command=/opt/venv/bin/celery -A config beat --loglevel=info
directory=/app
autostart=true
autorestart=true
priority=31
environment=PYTHONUNBUFFERED=1,PATH="/opt/venv/bin:%(ENV_PATH)s"
stdout_logfile=/var/log/supervisor/celery_beat-stdout.log
stderr_logfile=/var/log/supervisor/celery_beat-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stopwaitsecs=30
